## 1. 产品定位 & 核心理念

**一句话：**
这是一个「省心型」的股票持仓管理助手，不做聊天框、不帮用户选股，只帮用户**看仓位、盯风险、给调仓建议**。

典型用户画像：

* 上班很忙、没时间盯盘
* 已经有一篮子股票（甚至 ETF、基金），**自己承担选股责任**
* 希望 AI 每天/每周帮他：

  * 盯盘、监控消息和风险（日频）
  * 给出有理有据的调仓建议（周频）
  * 提供一个收益 & 回测看板（随时打开看）

所以你的产品更加接近一个 **「智能投研+风控助手」**，而不是一个「聊天机器人」。push > chat，这就是“省心”。

---

## 2. 功能拆解（从需求到模块）

结合你聊天记录 & 现有代码，我按产品模块帮你整理一下。

### 2.1 持仓录入 & 账户配置

* 用户只需做一件事：**录入/维护自己的持仓**，包括：

  * 股票代码
  * 持仓数量
  * 成本价
  * 总资产/可用资金
* 其他参数通过配置给 AI：

  * 风险偏好（保守/稳健/激进）
  * 调仓周期偏好（默认周度，可选半月/一月）
  * 单票最大仓位、行业集中度等约束（可选）
* 当前你是通过 `stock_position.json` 预置这些信息，后续会迁到数据库 + 前端配置页面。

> 产品原则：**不对用户的“选股”负责，只对“持仓管理最优化”负责**。

---

### 2.2 数据采集 &指标计算（Wind + 技术指标）

后端每天从 Wind 拉历史行情 & 基本面，并计算关键技术指标，封装成统一结构喂给大模型。你现在的 `stock_query.py` 已经在做第一版：

* 从 Wind 获取：

  * 收盘价、成交量
  * PE(TTM)、换手率等
* 计算技术指标：

  * MA：5 / 10 / 20 / 30 / 250 日
  * RSI：6 / 12 / 24
  * MACD：DIF / DEA / MACD
  * BOLL：中轨 / 上轨 / 下轨
* 汇总成 DataFrame → 再转 JSON。

这一步的目标：
**「把原始行情 & 技术指标压缩成结构化 JSON」**，后面所有 AI 分析、周报推送，就都围绕这套结构来玩。

---

### 2.3 AI 分析引擎（日/周）

#### 2.3.1 日报：盯盘 + 风险提醒（阶段 1.5）

* 触发频率：交易日收盘后（例如 15:30–16:00）。
* 数据输入：

  * 当天收盘价 + 当天技术指标
  * 持仓 & 浮盈浮亏
  * 基本面突发事件/舆情（后续接入）
* 输出内容（偏短平快）：

  * 每只股票简单评价（趋势 & 风险）
  * 是否触发预警条件（跌破关键支撑、放量大跌、高位放量等）
  * **当天「无需调仓 / 建议小调整 / 风险较大建议关注」的结论**

#### 2.3.2 周报：调仓建议（目前你已有雏形）

你现在的 `vx_notice_push.py` 已经在做「每周投资分析报告」，包括技术分析、基本面、仓位风险、组合建议，并通过 Server 酱推送到微信：

核心流程：

1. 读取 `stock_position.json` 配置（stocks、positions、cost_prices、total_assets）。
2. 调用 `get_stock_recent_info` 获取行情 + 技术指标。
3. DataFrame 清洗 → JSON 化 `sanitize_dataframe`。
4. 拼出一个较长的大 Prompt（Task/Requirements/Inputs/Output）给大模型：

   * 每只股票：趋势 + 支撑阻力 + 技术结构分析
   * 商业模式 & 基本面（如数据有限则模型基于常识）
   * 持仓盈亏分析
   * 组合层面风险 & 操作建议
5. 使用流式接口获取模型输出，提取从「每周投资分析报告」开始的正文。
6. 通过 Server 酱推送到微信。

**未来演进：**

* 拆成「日报提示词」和「周报提示词」两套模版（你自己也提到）。
* 统一为 JSON 输出 schema（便于前端做结构化展示 & 调仓自动化）。
* 周报里加一个明确的「调仓建议数组」，每一条是：`{code, name, action, target_weight_change, reason}`。

---

### 2.4 调仓流程（半自动）

你的设想是：

> AI 提示调仓 → 用户确认 → 系统只改数据库，真正下单去同花顺/券商。

标准流程可以这样：

1. **周报/推送中附带一份结构化调仓建议**（如 JSON 或表格）。
2. 用户在前端「调仓确认页」里：

   * 勾选要执行的建议
   * 调整目标仓位（可微调）
   * 点击确认
3. 后端只做两件事：

   * 把「调仓方案」记录下来（方便回测 & 复盘）
   * 根据确认后的目标仓位更新持仓表（模拟已成交）
4. 提醒用户：**请在实际券商 APP（如同花顺）中执行相同操作**。

未来你也可以考虑增加个「对比视图」：

* 左侧是「当前真实仓位」（手动更新同步）
* 右侧是「AI 模拟仓位」（回测 & 试验用）

---

### 2.5 看板 & 回测（阶段 2）

这个部分你说要放到阶段二，但我在逻辑上先帮你设计一下，方便前后端解耦。

**主要功能：**

1. **收益看板**

   * 总资产曲线 / 组合净值曲线
   * 每只股票持仓市值、浮盈浮亏
   * 行业/主题分布饼图
   * 仓位变化历史（结合调仓记录）

2. **回测/策略效果**

   * 基于「AI 调仓记录」和「历史行情」，计算：

     * 若按 AI 建议执行 vs 实际执行 的收益差异
     * 最大回撤、夏普等简单风险指标
   * 可选择时间段、过滤调仓策略参数（未来可扩展）

3. **AI 分析记录**

   * 日报/周报历史列表
   * 点进详情可以看到当时的建议 + 之后实际走势（用于用户建立信任）

---

## 3. 技术架构：React / Next.js + FastAPI

### 3.1 后端（FastAPI）

**主要模块设计：**

1. **账号 & 持仓模块**

   * 用户注册/登录（初期可以只做内网或简单 token）
   * 持仓 CRUD（增删改查）
   * 用户偏好（风险偏好、调仓周期等）

2. **数据服务模块**

   * 与 Wind 对接的数据采集脚本（你已有 `get_stock_recent_info`）。
   * 定时任务：

     * 每日收盘后拉行情、计算指标
     * 每周固定时间触发周度分析（你现在用 APScheduler 的 BlockingScheduler，可以抽象成服务级别）。

3. **AI 分析模块**

   * 统一封装调用大模型的接口（你现在对接的是 `gemini-3-pro-preview-thinking` 本地代理）。
   * 内置 Prompt 模板（日报/周报各一份）
   * 输入：结构化 JSON（持仓 + 指标）
   * 输出：结构化 JSON + Markdown 文本（供前端 & 推送使用）

4. **通知推送模块**

   * Server 酱/企业微信/公众号推送封装（你已有 `push_wechat`）。
   * 支持：

     * 周报推送
     * 日报推送
     * 风险单独预警（后续）

5. **报表 & 回测模块**

   * 对数据库里的：

     * 历史持仓
     * 调仓记录
     * 行情快照
   * 做统计 &回测 API，提供给前端看板使用。

---

### 3.2 前端（React + Next.js）

#### 核心页面结构：

1. **Dashboard / 收益看板**

   * 顶部：总资产、今日盈亏、累计收益、最大回撤等卡片
   * 中间：组合净值曲线 + 对比基准（如沪深300）
   * 下方：持仓列表表格（市值、盈亏、仓位、最新技术信号）

2. **持仓管理页面**

   * Form：录入/编辑股票代码、数量、成本等
   * 支持导入 CSV / 从 JSON 预加载（兼容现在的 `stock_position.json`）

3. **AI 报告 & 调仓页面**

   * 左侧：最新日报/周报（Markdown 或富文本）
   * 右侧：模型输出的「调仓建议列表」，可以勾选、修改目标仓位、点击确认执行（更新数据库）

4. **配置 & 通知设置**

   * 设置风险偏好、调仓周期
   * 配置通知渠道（Server 酱 key / 企业微信 webhooks 等）

---

## 4. 前端可以借鉴的项目（Next.js / React 看板）

结合你要用 Next.js / React / Tailwind 的方向，我帮你挑了几类可以直接 fork / 抄布局的开源项目：

1. **通用 Next.js Admin Dashboard 模板**

   * **TailAdmin free-nextjs-admin-dashboard**：Next.js + Tailwind，现成的卡片、表格、左侧菜单、顶部导航，拿来就能堆出一个专业 dashboard。([GitHub][3])
你可以的开发策略：

* 用一个 Next.js Admin 模板（TailAdmin/NextAdmin）做**整体框架**（布局 + 菜单 + 主题）。
* 再从股票相关项目里抄「图表组件 & 持仓表格布局」，替换数据源为你自己的 API。

---

## 5. 总结一下你的需求（可以直接贴给同事/写在 PRD 开头）

> 我们要做一个“省心型”的股票持仓智能管家。
> 用户只需要录入自己的持仓，系统就会接管后面的「盯盘、调仓建议、收益分析和回测」，以**每日短报告 + 每周深度报告 + Web 看板**的形式服务用户。
>
> * **不做聊天窗口，不替用户选股**，只对“当前持仓管理最优化”负责。
> * 日级维度：帮用户盯盘，看风险和突发消息，输出简明的风险/操作提示。
> * 周级维度：结合技术面和基本面，生成结构化的调仓建议，推送到微信/企业微信，由用户确认后更新系统持仓。
> * Web 前端通过 React + Next.js 提供持仓管理、收益看板和回测结果展示。
> * 后端用 FastAPI + Wind 数据 + 大模型（JSON 结构输入/输出）做投研引擎，通过定时任务每日/每周自动跑分析，并推送通知。
